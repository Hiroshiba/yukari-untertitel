<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Web Speech API</title>
    <script>
        let flushFlag = true

        setInterval(function () {
            flushFlag = true;
        }, 1000)

        function vrFunction() {
            window.SpeechRecognition = window.SpeechRecognition || webkitSpeechRecognition;
            var recognition = new webkitSpeechRecognition();
            recognition.lang = 'ja';
            recognition.interimResults = true;
            recognition.continuous = true;

            recognition.onsoundstart = function () {
                console.log("認識中");
            };
            recognition.onnomatch = function () {
                console.log("もう一度試してください");
            };
            recognition.onerror = function () {
                console.log("エラー");
                vrFunction();
            };
            recognition.onsoundend = function () {
                console.log("停止中");
                vrFunction();
            };

            recognition.onresult = function (event) {
                if (!flushFlag) {
                    return;
                }
                flushFlag = false;

                let text = '';
                var results = event.results;
                for (var i = event.resultIndex; i < results.length; i++) {
                    text += results[i][0].transcript;
                }
                document.getElementById('result_text').innerHTML = text;
            }
            recognition.start();
        }
        window.onload = vrFunction;
    </script>
</head>

<body style="margin: 0; background: #00ff00">
    <dir id="result_text" style="
    padding-inline-start: 0;
    border:none;
    background: transparent;
    font-weight: bold;
    color: #ff00ff;
    text-shadow: 0.5px 0.5px 0 #fff,
                 -0.5px 0.5px 0 #fff,
                 0.5px -0.5px 0 #fff,
                 -0.5px -0.5px 0 #fff;
    "></dir>
</body>

</html>